(window["webpackJsonpPluginswag-extension-store"]=window["webpackJsonpPluginswag-extension-store"]||[]).push([[492],{1614:function(){},2492:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}}),s(2288);var n=Shopware.Component.wrapComponentConfig({template:'{% block sw_in_app_purchase_checkout_modal %}\n<sw-modal\n    v-if="store.entry"\n    class="sw-in-app-purchase-checkout"\n    :title="$tc(\'sw-in-app-purchase-checkout.modalTitle\')"\n    @modal-close="handleStateActions(false)"\n>\n    <template v-if="state === \'purchase\'" #modal-title>\n        <sw-extension-icon\n            class="sw-in-app-purchase-checkout__icon"\n            :src="extensionIcon"\n        />\n\n        <div class="sw-in-app-purchase-checkout__titles">\n            <h4 id="modalTitleEl" class="sw-modal__title">\n                {{ $tc(\'sw-in-app-purchase-checkout.modalTitle\') }}\n            </h4>\n\n            <h5 class="sw-modal__subtitle">\n                {{ extension.label }}\n            </h5>\n        </div>\n    </template>\n\n    <sw-in-app-purchase-checkout-overview\n        v-if="state === \'purchase\'"\n        v-model:tos-accepted="tosAccepted"\n        v-model:gtc-accepted="gtcAccepted"\n        v-model:variant="variant"\n        :purchase="purchase"\n        :producer="extension.producerName"\n    />\n\n    <sw-in-app-purchase-checkout-state\n        v-if="[\'loading\', \'success\', \'error\'].includes(state)"\n        :state="state"\n        :error-snippet="errorMessage"\n    />\n\n    <template #modal-footer>\n        <sw-in-app-purchase-checkout-button\n            :state="state"\n            :tos-accepted="tosAccepted"\n            :gtc-accepted="gtcAccepted"\n            :variant="variant"\n            @click="handleStateActions(true)"\n        />\n    </template>\n</sw-modal>\n{% endblock %}\n',inject:["inAppPurchasesService"],mixins:[Shopware.Mixin.getByName("notification")],data(){return{state:"loading",store:Shopware.Store.get("inAppPurchaseCheckout"),inAppPurchaseCart:null,extension:null,purchase:null,tosAccepted:!1,gtcAccepted:!1,variant:null,errorMessage:null}},created(){this.createdComponent()},computed:{assetFilter(){return Shopware.Filter.getByName("asset")},extensionIcon(){return this.extension?.icon?this.extension.icon:this.extension?.iconRaw?`data:image/png;base64, ${this.extension.iconRaw}`:this.assetFilter("administration/static/img/theme/default_theme_preview.jpg")},storeExtension(){let e=this.store.extension;return(Shopware.Utils.types.isObject(e)?e?.name:e)??""}},methods:{createdComponent(){this.store.$subscribe(()=>{this.requestFeature()})},async requestFeature(){if(!this.store.extension||!this.store.entry){this.reset();return}this.state="loading",await Promise.all([this.inAppPurchasesService.getExtension(this.store.extension),this.inAppPurchasesService.getPriceModels(this.store.extension,this.store.entry.identifier)]).then(([e,t])=>{this.purchase=t,this.extension=e,this.state="purchase"}).catch(e=>{Shopware.Utils.debug.error(e),this.errorMessage=this.getError(e),this.state="error"})},onPurchaseFeature(){if(!this.store.extension||!this.store.entry||!this.variant){this.reset();return}this.inAppPurchasesService.createCart(this.store.extension,this.store.entry.identifier,this.variant).then(e=>this.inAppPurchasesService.orderCart(e?.taxRate,e?.positions,this.extension?.name)).then(()=>{this.state="success"}).catch(e=>{Shopware.Utils.debug.error(e),this.errorMessage=this.getError(e),this.state="error"})},handleStateActions(e){switch(this.state){case"purchase":e?this.onPurchaseFeature():this.reset();break;case"error":e?this.requestFeature():this.reset();break;case"success":this.reset(),this.inAppPurchasesService.refreshInAppPurchases().then(()=>{window.location.reload()});break;default:this.reset()}},getError(e){return e?.response?.data.errors[0]?.detail??null},reset(){this.store.dismiss(),this.inAppPurchaseCart=null,this.extension=null,this.errorMessage=null,this.state="loading",this.purchase=null,this.variant=null,this.tosAccepted=!1,this.gtcAccepted=!1}}})},2288:function(e,t,s){var n=s(1614);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),s(5346).Z("42c84ea1",n,!0,{})},5346:function(e,t,s){"use strict";function n(e,t){for(var s=[],n={},r=0;r<t.length;r++){var i=t[r],a=i[0],o={id:e+":"+r,css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(o):s.push(n[a]={id:a,parts:[o]})}return s}s.d(t,{Z:function(){return f}});var r="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!r)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},a=r&&(document.head||document.getElementsByTagName("head")[0]),o=null,c=0,h=!1,u=function(){},p=null,l="data-vue-ssr-id",d="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,s,r){h=s,p=r||{};var a=n(e,t);return m(a),function(t){for(var s=[],r=0;r<a.length;r++){var o=i[a[r].id];o.refs--,s.push(o)}t?m(a=n(e,t)):a=[];for(var r=0;r<s.length;r++){var o=s[r];if(0===o.refs){for(var c=0;c<o.parts.length;c++)o.parts[c]();delete i[o.id]}}}}function m(e){for(var t=0;t<e.length;t++){var s=e[t],n=i[s.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](s.parts[r]);for(;r<s.parts.length;r++)n.parts.push(g(s.parts[r]));n.parts.length>s.parts.length&&(n.parts.length=s.parts.length)}else{for(var a=[],r=0;r<s.parts.length;r++)a.push(g(s.parts[r]));i[s.id]={id:s.id,refs:1,parts:a}}}}function v(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function g(e){var t,s,n=document.querySelector("style["+l+'~="'+e.id+'"]');if(n){if(h)return u;n.parentNode.removeChild(n)}if(d){var r=c++;t=x.bind(null,n=o||(o=v()),r,!1),s=x.bind(null,n,r,!0)}else t=b.bind(null,n=v()),s=function(){n.parentNode.removeChild(n)};return t(e),function(n){n?(n.css!==e.css||n.media!==e.media||n.sourceMap!==e.sourceMap)&&t(e=n):s()}}var w=function(){var e=[];return function(t,s){return e[t]=s,e.filter(Boolean).join("\n")}}();function x(e,t,s,n){var r=s?"":n.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function b(e,t){var s=t.css,n=t.media,r=t.sourceMap;if(n&&e.setAttribute("media",n),p.ssrId&&e.setAttribute(l,t.id),r&&(s+="\n/*# sourceURL="+r.sources[0]+" */\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}}}]);