(window["webpackJsonpPluginswag-pay-pal"]=window["webpackJsonpPluginswag-pay-pal"]||[]).push([[3143],{8061:function(){},3143:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return i}}),a(9182);var i=Shopware.Component.wrapComponentConfig({template:'<a\n    :href="onboardingUrl"\n    :disabled="isDisabled"\n    :class="classes"\n    class="swag-paypal-onboarding-button"\n    target="_blank"\n    :data-paypal-onboard-complete="callbackName"\n    data-paypal-button="true"\n>\n    <sw-loader\n        v-if="isLoading"\n        class="sw-button_loader"\n        size="20px"\n    />\n\n    <slot>\n        {{ buttonTitle }}\n    </slot>\n</a>\n',compatConfig:Shopware.compatConfig,inject:["acl","SwagPayPalSettingsService"],emits:["onboarded"],mixins:[Shopware.Mixin.getByName("notification")],props:{type:{type:String,required:!1,default:"live"},variant:{type:String,required:!1,default:"ghost"},disabled:{type:Boolean,required:!1,default:!1}},data(){return{type:this.$props.type,callbackId:Shopware.Utils.createId(),isLoading:!0,scriptId:"paypal-js",scriptURL:"https://www.paypal.com/webapps/merchantboarding/js/lib/lightbox/partner.js",live:{partnerId:"DYKPBPEAW5JNA",partnerClientId:"AR1aQ13lHxH1c6b3CDd8wSY6SWad2Lt5fv5WkNIZg-qChBoGNfHr2kT180otUmvE_xXtwkgahXUBBurW",sellerNonce:`${Shopware.Utils.createId()}${Shopware.Utils.createId()}`},sandbox:{partnerId:"45KXQA7PULGAG",partnerClientId:"AQ9g8qMYHpE8s028VCq_GO3Roy9pjeqGDjKTkR_sxzX0FtncBb3QUWbFtoQMtdpe2lG9NpnDT419dK8s",sellerNonce:`${Shopware.Utils.createId()}${Shopware.Utils.createId()}`},commonRequestParams:{channelId:"partner",product:"ppcp",secondaryProducts:"advanced_vaulting,PAYMENT_METHODS",capabilities:"APPLE_PAY,GOOGLE_PAY,PAY_UPON_INVOICE,PAYPAL_WALLET_VAULTING_ADVANCED",integrationType:"FO",features:"PAYMENT,REFUND,READ_SELLER_DISPUTE,UPDATE_SELLER_DISPUTE,ADVANCED_TRANSACTIONS_SEARCH,ACCESS_MERCHANT_INFORMATION,TRACKING_SHIPMENT_READWRITE,VAULT,BILLING_AGREEMENT",displayMode:"minibrowser",partnerLogoUrl:"https://assets.shopware.com/media/logos/shopware_logo_blue.svg"}}},watch:{"$props.type"(){this.type=this.$props.type}},computed:{settingsStore(){return Shopware.Store.get("swagPayPalSettings")},merchantInformationStore(){return Shopware.Store.get("swagPayPalMerchantInformation")},isSandbox(){return"sandbox"===this.type},suffix(){return this.isSandbox?"Sandbox":""},returnUrl(){return`${window.location.origin}${window.location.pathname}#${this.$route.path}?ppOnboarding=${this.type}`},requestParams(){return this.isSandbox?this.sandbox:this.live},onboardingUrl(){let t=new URL("/bizsignup/partner/entry",this.isSandbox?"https://www.sandbox.paypal.com":"https://www.paypal.com");return t.search=new URLSearchParams({...this.commonRequestParams,...this.requestParams,returnToPartnerUrl:this.returnUrl}).toString(),t.href},buttonTitle(){return this.settingsStore.get(`SwagPayPal.settings.clientSecret${this.suffix}`)?this.settingsStore.isSandbox!==this.isSandbox||this.merchantInformationStore.canPPCP?this.$t(`swag-paypal-onboarding-button.${this.type}.changeTitle`):this.$t(`swag-paypal-onboarding-button.${this.type}.onboardingTitle`):this.$t(`swag-paypal-onboarding-button.${this.type}.title`)},callbackName(){return`onboardingCallback${this.callbackId}`},isDisabled(){return!this.acl.can("swag_paypal.editor")||this.isLoading||this.disabled},classes(){return{"is--sandbox":this.isSandbox,"is--live":!this.isSandbox,"is--link":"link"===this.variant,"sw-button":"ghost"===this.variant,"sw-button--ghost":"ghost"===this.variant,"is--disabled":this.isDisabled}}},mounted(){this.onMounted()},beforeUnmount(){delete window[this.callbackName]},methods:{onMounted(){this.acl.can("swag_paypal.editor")&&(Object.hasOwn(this.$route.query,"ppOnboarding")&&this.completeOnboarding(),window[this.callbackName]=(t,e)=>{this.fetchCredentials(t,e)},this.loadPayPalScript())},createScriptElement(){let t=document.createElement("script");return t.id=this.scriptId,t.type="text/javascript",t.src=this.scriptURL,t.async=!0,document.head.appendChild(t),t},loadPayPalScript(){let t=document.getElementById(this.scriptId)??this.createScriptElement();window.PAYPAL?(this.isLoading=!1,window.PAYPAL.apps.Signup.setup()):t.addEventListener("load",this.renderPayPalButton.bind(this),!1)},renderPayPalButton(){this.isLoading=!1,window.PAYPAL.apps.Signup.render=function(){window.PAYPAL.apps.Signup.timeout&&clearTimeout(window.PAYPAL.apps.Signup.timeout),window.PAYPAL.apps.Signup.timeout=setTimeout(window.PAYPAL.apps.Signup.render,300)},window.PAYPAL.apps.Signup.render()},async fetchCredentials(t,e){if(this.isLoading)return;this.isLoading=!0;let a=await this.SwagPayPalSettingsService.getApiCredentials(t,e,this.requestParams.sellerNonce,this.isSandbox).catch(()=>(this.createNotificationError({message:this.$t("swag-paypal.settingForm.credentials.button.messageFetchedError"),duration:1e4}),{}));this.setConfig(a.client_id,a.client_secret,a.payer_id),this.isLoading=!1},setConfig(t,e,a){this.settingsStore.set(`SwagPayPal.settings.clientId${this.suffix}`,t),this.settingsStore.set(`SwagPayPal.settings.clientSecret${this.suffix}`,e),this.settingsStore.set(`SwagPayPal.settings.merchantPayerId${this.suffix}`,a),this.merchantInformationStore.canPPCP||this.settingsStore.set("SwagPayPal.settings.sandbox",this.isSandbox),this.$emit("onboarded")},completeOnboarding(){let{ppOnboarding:t,merchantIdInPayPal:e}=this.$route.query;if(this.$router.replace({query:{}}),!e||"sandbox"!==t&&"live"!==t)return;let a=String(e);this.settingsStore.set(`SwagPayPal.settings.merchantPayerId${"sandbox"===t?"Sandbox":""}`,a),this.$emit("onboarded")}}})},9182:function(t,e,a){var i=a(8061);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,a(534).A)("4ff06aa9",i,!0,{})}}]);